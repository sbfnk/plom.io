<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>simforence-population-based: /Users/seb/websites/simforence/simforence-population-based/simforence_model_builder/templates/src/C/kalman/ekf.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">simforence-population-based
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_382b62fd9ca97535352e87eb3043a695.html">C</a></li><li class="navelem"><a class="el" href="dir_6375b99d038702886e9a111fad55c2cc.html">kalman</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ekf.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="kalman_8h_source.html">kalman.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ekf.c:</div>
<div class="dyncontent">
<div class="center"><img src="ekf_8c__incl.png" border="0" usemap="#_2_users_2seb_2websites_2simforence_2simforence-population-based_2simforence__model__builder_2templates_2src_2_c_2kalman_2ekf_8c" alt=""/></div>
<map name="_2_users_2seb_2websites_2simforence_2simforence-population-based_2simforence__model__builder_2templates_2src_2_c_2kalman_2ekf_8c" id="_2_users_2seb_2websites_2simforence_2simforence-population-based_2simforence__model__builder_2templates_2src_2_c_2kalman_2ekf_8c">
<area shape="rect" id="node3" href="kalman_8h.html" title="kalman.h" alt="" coords="65,147,140,175"/><area shape="rect" id="node7" href="pmcmc_8h.html" title="pmcmc.h" alt="" coords="102,225,177,253"/></map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7a585fde2278383a27463577aeb448e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ekf_8c.html#a7a585fde2278383a27463577aeb448e9">reset_inc_Cov</a> (gsl_matrix *Ct)</td></tr>
<tr class="separator:a7a585fde2278383a27463577aeb448e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c6cad8522d93a76632e3353e34135ae"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ekf_8c.html#a0c6cad8522d93a76632e3353e34135ae">check_and_correct_Ct</a> (gsl_matrix *Ct)</td></tr>
<tr class="separator:a0c6cad8522d93a76632e3353e34135ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a390c67da64aa9d589478c50f444952"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ekf_8c.html#a0a390c67da64aa9d589478c50f444952">ekf_gain_computation</a> (double xk_t_ts, double data_t_ts, gsl_matrix *Ct, gsl_vector *ht, gsl_vector *kt, double sc_rt, double *sc_st, double *sc_pred_error)</td></tr>
<tr class="separator:a0a390c67da64aa9d589478c50f444952"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64afbbb87ee76c7fbc6f791d7feece57"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ekf_8c.html#a64afbbb87ee76c7fbc6f791d7feece57">ekf_update</a> (gsl_vector *xk, gsl_matrix *Ct, gsl_vector *ht, gsl_vector *kt, double sc_st, double sc_pred_error)</td></tr>
<tr class="separator:a64afbbb87ee76c7fbc6f791d7feece57"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0c6cad8522d93a76632e3353e34135ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_and_correct_Ct </td>
          <td>(</td>
          <td class="paramtype">gsl_matrix *&#160;</td>
          <td class="paramname"><em>Ct</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Brings Ct back to being symetric and semi-definite positive, in case numerical instabilities made it lose these properties.</p>
<p>In theory the EKF shouldn't need this, and there is no right way to bring back a wrong covariance matrix to being right, but this is the most natural way to go as far as I know. We shouldn't need this anymore with the Square-Root Unscented Kalman Filter.</p>
<p>This function could could be optimized, first making each operation quicker when possible, then starting by computing the eigen values to check if there is any problem and only running all the rest when needed </p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ekf_8c_a0c6cad8522d93a76632e3353e34135ae_cgraph.png" border="0" usemap="#ekf_8c_a0c6cad8522d93a76632e3353e34135ae_cgraph" alt=""/></div>
<map name="ekf_8c_a0c6cad8522d93a76632e3353e34135ae_cgraph" id="ekf_8c_a0c6cad8522d93a76632e3353e34135ae_cgraph">
<area shape="rect" id="node3" href="print_8c.html#ac37aabaddd82f7fb577609b2d06dd80f" title="print_err" alt="" coords="209,5,279,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ekf_8c_a0c6cad8522d93a76632e3353e34135ae_icgraph.png" border="0" usemap="#ekf_8c_a0c6cad8522d93a76632e3353e34135ae_icgraph" alt=""/></div>
<map name="ekf_8c_a0c6cad8522d93a76632e3353e34135ae_icgraph" id="ekf_8c_a0c6cad8522d93a76632e3353e34135ae_icgraph">
<area shape="rect" id="node3" href="kalman_8h.html#a0a390c67da64aa9d589478c50f444952" title="ekf_gain_computation" alt="" coords="208,30,360,58"/><area shape="rect" id="node17" href="kalman_8h.html#a64afbbb87ee76c7fbc6f791d7feece57" title="ekf_update" alt="" coords="240,82,328,110"/><area shape="rect" id="node5" href="kalman_8h.html#a5380c92e14bb079aa318516ccb39b95d" title="run_kalman" alt="" coords="408,57,499,85"/><area shape="rect" id="node7" href="kmcmc_8c.html#a8cb5c14f1653139f957ee74ad7c1890b" title="kmcmc" alt="" coords="579,5,642,33"/><area shape="rect" id="node11" href="kalman_2main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="586,57,636,85"/><area shape="rect" id="node13" href="simplex__kalman_8c.html#ab9d851a5cef109a6e42ad6395869e442" title="f_simplex_kalman" alt="" coords="547,109,675,137"/><area shape="rect" id="node9" href="kmcmc__main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="723,5,773,33"/><area shape="rect" id="node15" href="simplex__kalman_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="723,109,773,137"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0a390c67da64aa9d589478c50f444952"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ekf_gain_computation </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>xk_t_ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>data_t_ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gsl_matrix *&#160;</td>
          <td class="paramname"><em>Ct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gsl_vector *&#160;</td>
          <td class="paramname"><em>ht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gsl_vector *&#160;</td>
          <td class="paramname"><em>kt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>sc_rt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>sc_st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>sc_pred_error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Computation of the EKF gain kt for observation data_t_ts and obs jacobian ht, given estimate xk_t_ts and current covariance Ct xk_t_ts: (double) estimate at time t of the observed quantity data_t_ts: (double) observed quantity Ct: (N_KAL*N_KAL gsl_matrix) pointer to covariance matrix of the system at time t ht: (N_KAL gsl_vector) pointer to observation process jacobian kt: (N_KAL) pointer to ekf gain, will be updated in this function erasing the previous value sc_rt: (double) variance of the observation process sc_st: (double) pointer to the ekf scaler sc_st, will be updated in this function erasing the previous value pred_error: (double) pointer to the difference between obs and estimate, will be updated in this function erasing the previous value </p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ekf_8c_a0a390c67da64aa9d589478c50f444952_cgraph.png" border="0" usemap="#ekf_8c_a0a390c67da64aa9d589478c50f444952_cgraph" alt=""/></div>
<map name="ekf_8c_a0a390c67da64aa9d589478c50f444952_cgraph" id="ekf_8c_a0a390c67da64aa9d589478c50f444952_cgraph">
<area shape="rect" id="node3" href="ekf_8c.html#a0c6cad8522d93a76632e3353e34135ae" title="check_and_correct_Ct" alt="" coords="205,5,360,33"/><area shape="rect" id="node5" href="print_8c.html#ac37aabaddd82f7fb577609b2d06dd80f" title="print_err" alt="" coords="409,31,479,59"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ekf_8c_a0a390c67da64aa9d589478c50f444952_icgraph.png" border="0" usemap="#ekf_8c_a0a390c67da64aa9d589478c50f444952_icgraph" alt=""/></div>
<map name="ekf_8c_a0a390c67da64aa9d589478c50f444952_icgraph" id="ekf_8c_a0a390c67da64aa9d589478c50f444952_icgraph">
<area shape="rect" id="node3" href="kalman_8h.html#a5380c92e14bb079aa318516ccb39b95d" title="run_kalman" alt="" coords="205,57,296,85"/><area shape="rect" id="node5" href="kmcmc_8c.html#a8cb5c14f1653139f957ee74ad7c1890b" title="kmcmc" alt="" coords="376,5,440,33"/><area shape="rect" id="node9" href="kalman_2main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="383,57,433,85"/><area shape="rect" id="node11" href="simplex__kalman_8c.html#ab9d851a5cef109a6e42ad6395869e442" title="f_simplex_kalman" alt="" coords="344,109,472,137"/><area shape="rect" id="node7" href="kmcmc__main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="520,5,570,33"/><area shape="rect" id="node13" href="simplex__kalman_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="520,109,570,137"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a64afbbb87ee76c7fbc6f791d7feece57"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ekf_update </td>
          <td>(</td>
          <td class="paramtype">gsl_vector *&#160;</td>
          <td class="paramname"><em>xk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gsl_matrix *&#160;</td>
          <td class="paramname"><em>Ct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gsl_vector *&#160;</td>
          <td class="paramname"><em>ht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gsl_vector *&#160;</td>
          <td class="paramname"><em>kt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>sc_st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>sc_pred_error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update of the state vector xt and covariance matrix Ct, for a given gain kt xk: (N_KAL gsl_vector) pointer to full state vector at time t Ct: (N_KALxN_KAL gsl_matrix) pointer to covariance matrix of the system at time t kt: (N_KAL gsl_vector) pointer to the gain vector kt sc_st: (double) pred_error: (double) difference between obs and estimate </p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ekf_8c_a64afbbb87ee76c7fbc6f791d7feece57_cgraph.png" border="0" usemap="#ekf_8c_a64afbbb87ee76c7fbc6f791d7feece57_cgraph" alt=""/></div>
<map name="ekf_8c_a64afbbb87ee76c7fbc6f791d7feece57_cgraph" id="ekf_8c_a64afbbb87ee76c7fbc6f791d7feece57_cgraph">
<area shape="rect" id="node3" href="print_8c.html#ac37aabaddd82f7fb577609b2d06dd80f" title="print_err" alt="" coords="345,24,415,52"/><area shape="rect" id="node5" href="ekf_8c.html#a0c6cad8522d93a76632e3353e34135ae" title="check_and_correct_Ct" alt="" coords="141,24,296,52"/><area shape="rect" id="node8" href="likelihood__template_8c.html#ab1091e9300f6a9a98e26dfd325f7bbea" title="sanitize_likelihood" alt="" coords="154,76,283,104"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ekf_8c_a64afbbb87ee76c7fbc6f791d7feece57_icgraph.png" border="0" usemap="#ekf_8c_a64afbbb87ee76c7fbc6f791d7feece57_icgraph" alt=""/></div>
<map name="ekf_8c_a64afbbb87ee76c7fbc6f791d7feece57_icgraph" id="ekf_8c_a64afbbb87ee76c7fbc6f791d7feece57_icgraph">
<area shape="rect" id="node3" href="kalman_8h.html#a5380c92e14bb079aa318516ccb39b95d" title="run_kalman" alt="" coords="141,57,232,85"/><area shape="rect" id="node5" href="kmcmc_8c.html#a8cb5c14f1653139f957ee74ad7c1890b" title="kmcmc" alt="" coords="312,5,376,33"/><area shape="rect" id="node9" href="kalman_2main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="319,57,369,85"/><area shape="rect" id="node11" href="simplex__kalman_8c.html#ab9d851a5cef109a6e42ad6395869e442" title="f_simplex_kalman" alt="" coords="280,109,408,137"/><area shape="rect" id="node7" href="kmcmc__main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="456,5,506,33"/><area shape="rect" id="node13" href="simplex__kalman_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="456,109,506,137"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7a585fde2278383a27463577aeb448e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reset_inc_Cov </td>
          <td>(</td>
          <td class="paramtype">gsl_matrix *&#160;</td>
          <td class="paramname"><em>Ct</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>reset incidence-related rows and columns to 0 </p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ekf_8c_a7a585fde2278383a27463577aeb448e9_icgraph.png" border="0" usemap="#ekf_8c_a7a585fde2278383a27463577aeb448e9_icgraph" alt=""/></div>
<map name="ekf_8c_a7a585fde2278383a27463577aeb448e9_icgraph" id="ekf_8c_a7a585fde2278383a27463577aeb448e9_icgraph">
<area shape="rect" id="node3" href="kalman_8h.html#a5380c92e14bb079aa318516ccb39b95d" title="run_kalman" alt="" coords="160,57,251,85"/><area shape="rect" id="node5" href="kmcmc_8c.html#a8cb5c14f1653139f957ee74ad7c1890b" title="kmcmc" alt="" coords="331,5,394,33"/><area shape="rect" id="node9" href="kalman_2main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="338,57,388,85"/><area shape="rect" id="node11" href="simplex__kalman_8c.html#ab9d851a5cef109a6e42ad6395869e442" title="f_simplex_kalman" alt="" coords="299,109,427,137"/><area shape="rect" id="node7" href="kmcmc__main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="475,5,525,33"/><area shape="rect" id="node13" href="simplex__kalman_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="475,109,525,137"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Nov 11 2012 10:22:35 for simforence-population-based by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
